// once config has been applied
getConfigFile.done(function() {
	// create the file uploader
	formOptions.dxfTime = {
		"type": "generic",
		"noParse": true,
		"template":
		"<div class='btn-group' role='group'>" +
			"<label type='button' for='dxf-file-picker' class='btn dxf-file-picker-label'>" +
				"<span data-form-el-type='file' class='form-control btn-default form-simple-button form-file-picker job-file-upload' data-toggle='tooltip' data-placement='bottom' title='Upload DXF to get automatic time estimate'>" +
					"Upload DXF <input type='file' id='dxf-file-picker'>" +
				"</span>" +
			"</label>" +
			"<button type='button' class='btn btn-default form-simple-button' data-toggle='tooltip' data-placement='bottom' title='Enter cut time estimate manually'>Manual time estimate</button>" +
		"</div>",
		"onRender": function() {
			// hide normal time estimate box and move button to right place
			$('.job-time-estimate').hide();
			// when the file is chosen
			$('#dxf-file-picker').change(function logData(data) {
				var file = $(this).get(0).files[0];
				var read = new FileReader();
				read.readAsBinaryString(file);
				read.onloadend = function transferFile() {
					// send it to the backend
					socketSend({"action": "send_dxf", "dxf_data": read.result});
				}
				// start a loader
				NProgress.start();
				acceptedAPIs.dxf_estimate = [function writeEstimate(data){
					NProgress.done();
					$('.job-time-estimate').val(data.time);
				}]
			});
		}
	}
	renderForm();
});
